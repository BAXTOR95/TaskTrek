{% extends "dashboard.html" %}
<!-- Page Title-->
{% block title %}Projects{% endblock %}

<!-- Main Content -->
{% block content %}

<!-- Main Content -->
<h2 class="mb-4">Projects</h2>
<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
<!-- Display flash messages -->
{% if messages %}
<!-- Loop through messages -->
{% for category, message in messages %}
<div
	class="alert {{ 'alert-success' if category == 'success' else 'alert-danger' }} alert-dismissible fade show text-center mb-3"
	role="alert"
	id="flash-message"
>
	{{ message }}
	<button
		type="button"
		class="btn-close"
		data-bs-dismiss="alert"
		aria-label="Close"
	></button>
</div>
<!-- End loop -->
{% endfor %}
<!-- End if -->
{% endif %}
<!-- End with -->
{% endwith %}
<div class="d-flex justify-content-end mb-2">
	<button
		type="button"
		class="btn btn-primary"
		data-bs-toggle="modal"
		data-bs-target="#addProjectModal"
	>
		<i class="fa-solid fa-plus"></i> Add New Project
	</button>

	<div
		class="modal fade"
		id="addProjectModal"
		tabindex="-1"
		aria-labelledby="addProjectModalLabel"
		aria-hidden="true"
	>
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="addProjectModalLabel">
						New Project
					</h1>
					<button
						type="button"
						class="btn-close"
						data-bs-dismiss="modal"
						aria-label="Close"
					></button>
				</div>
				<div class="modal-body">
					<form
						id="projectForm"
						method="post"
						action="{{ url_for('web.add_project') }}"
					>
						{{ form.hidden_tag() }}
						<!-- Title input -->
						<div class="form-floating form-floating-label mb-3">
							{{ form.title(class="form-control" + (" is-invalid" if
							form.title.errors else ""), placeholder="Insert the project's
							title") }}
							<label for="title" class="col-form-label">Project's Title</label>
							{% if form.title.errors %}
							<div class="invalid-feedback" style="display: block">
								{{ form.title.errors[0] }}
							</div>
							{% endif %}
						</div>
						<!-- Description input -->
						<div class="form-floating form-floating-label mb-3">
							{{ form.description(class="form-control" + (" is-invalid" if
							form.description.errors else ""), placeholder="Insert the
							project's description") }}
							<label for="description" class="col-form-label"
								>Project's Description</label
							>
							{% if form.description.errors %}
							<div class="invalid-feedback" style="display: block">
								{{ form.description.errors[0] }}
							</div>
							{% endif %}
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button
						type="button"
						class="btn btn-secondary"
						data-bs-dismiss="modal"
					>
						Close
					</button>
					{{ form.submit(class="btn btn-primary", id="submitForm") }}
				</div>
			</div>
		</div>
	</div>
</div>
<div class="project-grid">
	<!-- Project cards -->
	{% for project in projects %}
	<div class="project-card" onclick="redirectToProject('{{ url_for('web.project_detail', project_id=project.id) }}')">
		<!-- Form for deletion -->
		<form
			action="{{ url_for('web.delete_project', project_id=project.id) }}"
			method="POST"
		>
			{{ form.csrf_token }}
			<button
				type="submit"
				class="delete-btn"
				onclick="event.stopPropagation(); return confirm('Are you sure you want to delete this project?');"
			>
				<i class="fa-solid fa-trash text-danger"></i>
			</button>
		</form>
		<h5>{{ project.title }}</h5>
		<p>{{ project.description }}</p>
	</div>
	{% endfor %}
	<!-- Repeat for more projects -->
</div>

{% endblock %}
